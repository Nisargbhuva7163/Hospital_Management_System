<%= stylesheet_link_tag "organizations/show", media: "all" %>


<div class="container mt-5">
  <!-- üè• Organization Details -->
  <div class="card shadow-sm mb-4">
    <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
      <h3 class="mb-0">üè• Organization Details</h3>
      <%= link_to "‚úèÔ∏è Edit", edit_organization_path(@organization), class: "btn btn-light btn-sm" %>
    </div>

    <div class="card-body">
      <div class="row">
        <div class="col-md-8">
          <p><strong>Name:</strong> <%= @organization.org_name %></p>
          <p><strong>Email (Logged-in User):</strong> <%= current_user.email %></p>
          <p><strong>Phone Number:</strong> <%= @organization.phone_number %></p>
          <p><strong>Address:</strong> <%= @organization.address %></p>
          <p><strong>Created At:</strong> <%= @organization.created_at.strftime('%d %b %Y, %I:%M %p') %></p>
        </div>
        <div class="col-md-4 text-center">
          <% if current_user.organization.qr_code.attached? %>
            <%= image_tag url_for(current_user.organization.qr_code), class: "img-fluid border rounded p-2 bg-white", style: "max-width: 200px;" %>
            <p class="mt-2 text-muted">Scan to access your organization</p>
          <% else %>
            <p class="text-muted">No QR code generated yet.</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- üìä Dashboard Summary -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-dark text-white">
      <h4 class="mb-0">üìä Dashboard</h4>
    </div>

    <div class="card-body">
      <div class="row g-4">

        <!-- ü©∫ Doctor Status -->
        <div class="col-md-3">
          <div class="card text-white <%= @organization.checked_in? ? 'bg-success' : 'bg-danger' %> shadow">
            <div class="card-body text-center">
              <h6 class="card-title">Doctor Status</h6>
              <p class="fw-bold fs-5 mb-0">
                <%= @organization.checked_in? ? 'Available ‚úÖ' : 'Not Available ‚ùå' %>
              </p>
            </div>
          </div>
        </div>

        <!-- üé´ Current Token -->
        <div class="col-md-3" id="current-token-display">
          <%= render partial: "organizations/current_token", locals: { current_token: @current_token_appointment } %>
        </div>

        <!-- ‚èÆÔ∏è Last Token -->
        <div class="col-md-3" id="last-token-display">
          <div class="card bg-light shadow border-start border-5 border-secondary">
            <div class="card-body text-center">
              <h6 class="card-title">Last Token</h6>
              <p class="fw-bold fs-4 mb-0">
                <%= @last_token_appointment&.token_no || "‚Äî" %>
              </p>
            </div>
          </div>
        </div>

        <!-- üìã Total Appointments -->
        <div class="col-md-3" id="total-appointments-count">
          <div class="card bg-light shadow border-start border-5 border-info">
            <div class="card-body text-center">
              <h6 class="card-title">Total Appointments</h6>
              <div class="fs-4 fw-bold">
                <%= @total_appointments_count %>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- üîÑ Turbo Stream Live Updates -->
<%= turbo_stream_from "organization_#{@organization.id}_updates" %>
